      
# Configuration Gitpod Finale et Correcte

# Spécifie une image Docker complète qui inclut plus d'outils par défaut
image: gitpod/workspace-full

tasks:
  - name: "Préparation de l'Environnement"
    # La tâche 'before' s'exécute AVANT que l'IDE et les serveurs de langage ne démarrent
    before: |
      echo "--- TÂCHE 'BEFORE' : Configuration de Java 17 ---"
      sdk install java 17.0.10-zulu
      sdk default java 17.0.10-zulu
      source "/home/gitpod/.sdkman/bin/sdkman-init.sh"
      echo "--- Java 17 est maintenant la version par défaut pour tout le workspace ---"

  - name: "Installation et Compilation"
    # La tâche 'init' s'exécute après 'before' pour préparer les dépendances
    init: |
      echo "--- TÂCHE 'INIT' : Installation du SDK Android ---"
      sudo apt-get update && sudo apt-get install -y dos2unix
      
      wget -q https://dl.google.com/android/repository/commandlinetetools-linux-9477386_latest.zip -O commandlinetools.zip
      mkdir -p android-sdk/cmdline-tools
      unzip -q commandlinetools.zip -d android-sdk/cmdline-tools
      mv android-sdk/cmdline-tools/cmdline-tools android-sdk/cmdline-tools/latest
      rm commandlinetools.zip

      export ANDROID_HOME=$PWD/android-sdk
      export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools
      
      yes | sdkmanager --licenses >/dev/null
      sdkmanager "platforms;android-33" "build-tools;33.0.1" "platform-tools" >/dev/null
      
      echo "--- Préparation des scripts Gradle ---"
      dos2unix gradlew
      chmod +x ./gradlew

    # La tâche 'command' s'exécute à la fin pour lancer la compilation
    command: |
      echo "--- TÂCHE 'COMMAND' : Lancement de la compilation ---"
      ./gradlew assembleDebug --no-daemon
      
      echo "--- COMPILATION TERMINÉE ! ---"
      echo "L'APK se trouve dans le dossier : app/build/outputs/apk/debug/"

    